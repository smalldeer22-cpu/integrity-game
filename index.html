<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¸…å»‰å®ˆé–€å“¡ - å»‰æ”¿å®£å°äº’å‹•éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { touch-action: none; overflow: hidden; background-color: #f0f9ff; font-family: sans-serif; -webkit-user-select: none; user-select: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: linear-gradient(to bottom, #7dd3fc, #e0f2fe); overflow: hidden; }
        #player { position: absolute; bottom: 40px; width: 80px; height: 80px; transition: left 0.05s linear; z-index: 10; pointer-events: none; }
        .falling-item { position: absolute; width: 45px; height: 45px; z-index: 5; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        #flash-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 0, 0, 0.3); display: none; pointer-events: none; z-index: 50; }
        .floating-text { position: absolute; font-weight: bold; pointer-events: none; animation: floatUp 1s forwards; z-index: 60; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-50px); opacity: 0; } }
        .timer-warning { color: #ef4444 !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* æ’è¡Œæ¦œè‡ªå®šç¾©æ»‘è»¸ */
        #leaderboard-list::-webkit-scrollbar { width: 8px; }
        #leaderboard-list::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        #leaderboard-list::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; border: 2px solid #f1f5f9; }
        #leaderboard-list { scrollbar-width: thin; scrollbar-color: #3b82f6 #f1f5f9; }

        /* è§’è‰²åœ–ç‰‡å‹•ç•«æ¨£å¼ */
        .character-img {
            pointer-events: none;
            filter: drop-shadow(0 8px 12px rgba(0,0,0,0.12));
            animation: mascotFloat 4s ease-in-out infinite;
            flex-shrink: 0;
            object-fit: contain;
        }
        @keyframes mascotFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>

<div id="game-container">
    <!-- UI è³‡è¨Šæ¬„ -->
    <div id="ui-layer" class="absolute top-4 left-0 w-full flex justify-between px-6 z-20 pointer-events-none">
        <div class="bg-white/80 backdrop-blur rounded-full px-4 py-1 shadow-sm border border-white/50 text-blue-600 font-bold text-sm">
            å¾—åˆ†ï¼š<span id="score" class="text-xl font-black">0</span>
        </div>
        <div id="timer-box" class="bg-white/80 backdrop-blur rounded-full px-4 py-1 shadow-sm border border-white/50 text-red-600 font-bold text-sm">
            æ™‚é–“ï¼š<span id="timer" class="text-xl font-black">60</span>s
        </div>
    </div>

    <!-- é¦–é  -->
    <div id="start-screen" class="absolute inset-0 bg-white/95 z-40 flex flex-col items-center justify-center p-4 text-center">
        <div class="mb-4">
            <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#1d4ed8" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" fill="#3b82f6" fill-opacity="0.2"/><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4" stroke="#1d4ed8" stroke-width="2"/></svg>
        </div>
        <h1 class="text-2xl font-bold text-blue-800 mb-2 font-black">æ¸…å»‰å®ˆé–€å“¡</h1>
        <p class="text-gray-600 text-sm mb-6 px-8 leading-relaxed text-center font-bold">å·¦å³æ»‘å‹•è§’è‰²ï¼Œæ¥ä½æ­£ç¾©ï¼Œ<br>é¿é–‹ä¸ç•¶èª˜æƒ‘!</p>
        <div class="flex w-full max-w-md gap-4 mb-8 px-4">
            <div class="flex-1 bg-green-50 rounded-xl p-3 border border-green-200 shadow-sm text-center">
                <div class="text-green-700 font-black mb-2 text-xs border-b pb-1 text-center">åŠ åˆ† (+)</div>
                <div class="grid grid-cols-2 gap-1 items-center justify-items-center">
                    <div class="w-8 h-10"><svg viewBox="0 0 100 120"><rect x="15" y="10" width="70" height="100" rx="5" fill="#1a365d"/><rect x="10" y="10" width="8" height="100" fill="#2c5282"/><rect x="18" y="25" width="60" height="4" fill="#edbf2d" opacity="0.8"/><text x="52" y="65" text-anchor="middle" fill="#edbf2d" font-size="20" font-weight="black" font-family="Arial">LAW</text></svg></div>
                    <span class="text-xl">âš–ï¸</span><span class="text-xl">â˜€ï¸</span><span class="text-xl">ğŸ“</span><span class="col-span-2 text-xl text-center">ğŸ‘</span>
                </div>
            </div>
            <div class="flex-1 bg-red-50 rounded-xl p-3 border border-red-200 shadow-sm text-center">
                <div class="text-red-700 font-black mb-2 text-xs border-b pb-1 text-center">æ‰£åˆ† (-)</div>
                <div class="grid grid-cols-2 gap-1 text-xl items-center justify-items-center"><span>ğŸ§§</span><span>ğŸ¾</span><span>ğŸ’µ</span><span>ğŸ</span><span class="col-span-2 text-center">ğŸ’°</span></div>
            </div>
        </div>
        <button id="start-btn" class="bg-blue-600 text-white text-xl font-black py-4 px-14 rounded-full shadow-lg active:scale-95 transition-all outline-none">é–‹å§‹æŒ‘æˆ°</button>
        <p class="mt-4 text-[10px] text-gray-400 font-bold">è‡ºå—å¸‚æ”¿åºœæ”¿é¢¨è™•åœ˜éšŠ</p>
    </div>

    <!-- æš«åœè­¦ç¤º -->
    <div id="alert-screen" class="absolute inset-0 bg-black/60 z-50 hidden flex flex-col items-center justify-center p-6 text-center">
        <div class="bg-white rounded-3xl p-8 shadow-2xl max-w-sm w-full">
            <div class="text-5xl mb-6">ğŸš«</div>
            <h2 class="text-xl font-black text-red-600 mb-6 tracking-widest">æ³•ç¶²æ¢æ¢</h2>
            <div id="alert-message" class="text-gray-800 text-lg font-black leading-snug mb-6 tracking-wide text-center"></div>
            <div class="text-gray-400 text-xs italic font-bold">éŠæˆ² 1.5 ç§’å¾Œè‡ªå‹•ç¹¼çºŒ...</div>
        </div>
    </div>

    <!-- çµç®—ç•«é¢ -->
    <div id="end-screen" class="absolute inset-0 bg-white z-40 hidden flex flex-col items-center p-4 text-center overflow-y-auto">
        <div id="result-status" class="text-3xl font-black mb-2 mt-4 relative z-40"></div>
        
        <!-- åˆ†æ•¸èˆ‡å››å€‹è§’è‰²çš„æ©«å‘æ’åˆ— (ä¿ç•™æ–¼æ­¤) -->
        <div class="flex items-end justify-center w-full max-w-full overflow-hidden mb-2 relative z-10 px-1">
            <div class="flex items-end -space-x-8 flex-shrink-0">
                <img src="1000045680.jpg" class="character-img w-20 sm:w-28" alt="L1">
                <img src="1000045678.jpg" class="character-img w-24 sm:w-32" style="animation-delay: 0.5s;" alt="L2">
            </div>
            
            <div class="flex flex-col items-center justify-end px-2 pb-2 z-20 bg-white/50 rounded-lg">
                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-tighter">æ‚¨çš„æœ€çµ‚å¾—åˆ†</div>
                <div id="final-score-display" class="text-6xl font-black text-blue-600 tracking-tighter leading-none">0</div>
            </div>
            
            <div class="flex items-end -space-x-8 flex-shrink-0">
                <img src="1000045682.jpg" class="character-img w-24 sm:w-32" style="animation-delay: 1s;" alt="R1">
                <img src="259898.jpg" class="character-img w-20 sm:w-28" style="animation-delay: 1.5s;" alt="R2">
            </div>
        </div>

        <p id="result-comment" class="text-lg font-bold text-gray-800 mb-6 px-4 leading-tight relative z-40 border-t pt-2 w-full"></p>

        <!-- æ’è¡Œæ¦œäº’å‹•å€ -->
        <div id="leaderboard-section" class="w-full max-w-sm bg-blue-50/80 backdrop-blur rounded-2xl p-5 mb-6 border border-blue-100 shadow-inner relative z-50 text-center">
            <div id="upload-form">
                <p class="text-sm font-black text-blue-800 mb-4 tracking-tight">ğŸ† æŒ‘æˆ°å…¨åœ‹èª ä¿¡æ¦®è­½æ’è¡Œæ¦œ</p>
                <div class="space-y-3">
                    <input type="text" id="nickname" placeholder="è«‹è¼¸å…¥æš±ç¨± (8å­—å…§)" maxlength="8" class="w-full px-4 py-3 rounded-xl border border-blue-100 shadow-sm font-bold text-center outline-none focus:ring-2 focus:ring-blue-400 bg-white">
                    <button id="submit-btn" class="w-full bg-blue-600 text-white py-3.5 rounded-xl font-black text-lg shadow-lg active:translate-y-1 transition-all">
                        ç¢ºèªä¸¦ä¸Šå‚³åˆ†æ•¸
                    </button>
                </div>
                <div id="submit-error" class="text-red-500 text-xs mt-3 font-bold text-center leading-tight"></div>
            </div>
            
            <div id="rank-display" class="hidden relative">
                <!-- ğŸ’¡ ä¿®æ­£ï¼šç§»é™¤æ­¤è™•åŸæœ¬åœç¹åœ¨æ’åå·¦å³çš„å››éš»è§’è‰²åœ–ç‰‡ -->
                <div class="text-blue-700 font-black text-2xl mb-4 italic underline underline-offset-4 tracking-tighter text-center">
                    å…¨å°ç¸½æ’åï¼šç¬¬ <span id="user-rank"></span> å
                </div>
                
                <div id="rank-prize-msg" class="hidden bg-yellow-100 text-blue-900 font-black py-2 px-3 rounded-xl text-xs mb-3 shadow-sm border border-yellow-200 animate-pulse">
                    æ­å–œéé—œï¼è«‹å‘å·¥ä½œäººå“¡å‡ºç¤ºæ­¤ç•«é¢é ˜å–å®£å°å“ä¸€ä»½
                </div>

                <p class="text-[10px] text-gray-400 mb-2 font-bold text-center italic">â†“ æ‹–å‹•å³å´æ»‘è»¸æŸ¥çœ‹å®Œæ•´åå–® â†“</p>
                <div class="text-left bg-white/90 rounded-xl p-3 shadow-inner space-y-1 h-[240px] overflow-y-scroll border border-blue-50 text-sm mb-0" id="leaderboard-list"></div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-2 w-full mb-6 text-[10px] text-gray-600 border-y py-4 bg-gray-50/80 px-2 rounded-xl relative z-40 text-center">
            <div class="px-1 border-r flex items-center justify-center font-bold font-black italic">ã€Œé€éŒ¢é—œèªªï¼Ÿ<br>è§¸çŠ¯è¡Œè³„ç½ªï¼ã€</div>
            <div class="px-1 border-r flex items-center justify-center font-bold font-black italic">ã€Œæœ€å¥½çš„ç¦®ç‰©æ˜¯è®šç¾ï¼Œ<br>å»‰èƒ½æ”¿åºœä¸é€ç¦®ã€‚ã€</div>
            <div class="px-1 flex items-center justify-center font-bold font-black italic">ã€Œæª¢èˆ‰å…¬å‹™å“¡ç´¢è³„ï¼Œ<br>è«‹æ’¥ 0800-286-586ã€ã€‚</div>
        </div>

        <!-- ä¸€èˆ¬é ˜çæç¤ºæ–‡å­—å€å¡Š -->
        <div id="prize-message" class="text-blue-700 font-black mb-6 px-4 py-4 bg-yellow-50 border border-yellow-200 rounded-xl w-full max-sm text-sm shadow-sm relative z-40"></div>
        
        <!-- é‡ç©/ç¹¼çºŒæŒ‘æˆ°æŒ‰éˆ• -->
        <button id="final-restart-btn" onclick="location.reload()" class="w-full max-w-sm bg-gray-800 text-white font-black py-4 px-6 rounded-full shadow-lg active:scale-95 transition-all mb-10 text-center leading-tight text-lg relative z-40">
            å†ç©ä¸€æ¬¡
        </button>
    </div>

    <div id="flash-overlay"></div>

    <!-- è§’è‰²ï¼šå…¬å‹™å“¡ -->
    <div id="player">
        <svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-md">
            <rect x="25" y="60" width="50" height="40" rx="15" fill="#3b82f6" />
            <path d="M45 60 L50 75 L55 60" fill="white" />
            <path d="M48 75 L50 90 L52 75" fill="#1d4ed8" />
            <circle cx="50" cy="35" r="30" fill="#FFD1BA" />
            <circle cx="40" cy="30" r="3" fill="#333" /><circle cx="60" cy="30" r="3" fill="#333" />
            <path d="M42 45 Q50 52 58 45" stroke="#333" stroke-width="2" fill="none" />
            <rect x="20" y="80" width="60" height="18" rx="4" fill="rgba(0,0,0,0.5)" />
            <text x="50" y="93" text-anchor="middle" fill="white" font-size="10" font-weight="bold">å…¬å‹™å“¡</text>
        </svg>
    </div>
</div>

<script>
    // è«‹å¡«å…¥æ‚¨çš„ Google Apps Script URL
    const scriptURL = "https://script.google.com/macros/s/AKfycbyV0cPrTrmYdsr77GVq7CgcEXljBhIIJuy-b1EkwLoXS5vcvu-MwfSUJAgOvBHxVMcQRg/exec";

    const player = document.getElementById('player');
    const scoreElement = document.getElementById('score');
    const timerElement = document.getElementById('timer');
    const timerBox = document.getElementById('timer-box');
    const startScreen = document.getElementById('start-screen');
    const endScreen = document.getElementById('end-screen');
    const alertScreen = document.getElementById('alert-screen');
    const alertMessage = document.getElementById('alert-message');
    const finalScoreDisplay = document.getElementById('final-score-display');
    const resultStatus = document.getElementById('result-status');
    const resultComment = document.getElementById('result-comment');
    const prizeMessage = document.getElementById('prize-message');
    const flashOverlay = document.getElementById('flash-overlay');
    const submitError = document.getElementById('submit-error');
    const gameContainer = document.getElementById('game-container');
    const nicknameInput = document.getElementById('nickname');
    const rankPrizeMsg = document.getElementById('rank-prize-msg');
    const finalRestartBtn = document.getElementById('final-restart-btn');

    let score = 0, timeLeft = 60, gameActive = false, playerX = window.innerWidth / 2 - 40, items = [], timerInt, gameInt, slogans = [];
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

    const slogansBase = ["è¡Œè³„æ”¶è³„éƒ½æœ‰ç½ªï¼Œ<br>åˆ‡å‹¿ä»¥èº«è©¦æ³•ï¼", "æ‹’çµ•ç´…åŒ…èˆ‡è´ˆç¦®ï¼Œ<br>å®ˆè­·æ¸…å»‰æœ€å®‰å¿ƒï¼", "ç§‰å…¬è™•ç†ä¸åœ–åˆ©ï¼Œ<br>å…¬å¹³æ­£ç¾©åœ¨å¿ƒè£¡ï¼", "ä¸ç•¶é£²å®´æ‡‰æ‹’çµ•ï¼Œ<br>å»‰æ½”è‡ªå¾‹é æ˜¯éï¼", "é‡‘éŒ¢ç¾é…’è«å‹•å¿ƒï¼Œ<br>æ³•ç¶²æ¢æ¢é›£é€ƒè„«ï¼", "å…§éƒ¨æ­å¼Šè«æ“”æ†‚ï¼Œ<br>å·²æœ‰æ³•å¾‹ä¿è­·å”·", "è«æ”¶è«é€ä¸æ³•åˆ©ç›Šï¼Œ<br>å…§éƒ¨æ­å¼Šæ³¨è¦–è‘—ä½ "];

    const bookSvg = `<svg viewBox="0 0 100 120"><rect x="15" y="10" width="70" height="100" rx="5" fill="#1a365d"/><rect x="10" y="10" width="8" height="100" fill="#2c5282"/><rect x="18" y="25" width="60" height="4" fill="#edbf2d" opacity="0.8"/><text x="52" y="65" text-anchor="middle" fill="#edbf2d" font-size="20" font-weight="black" font-family="Arial">LAW</text></svg>`;
    const config = {
        good: [{t:'svg', i:bookSvg, p:10}, {t:'text', i:'âš–ï¸', p:10}, {t:'text', i:'â˜€ï¸', p:10}, {t:'text', i:'ğŸ“', p:15}, {t:'text', i:'ğŸ‘', p:10}],
        bad: [{t:'text', i:'ğŸ§§', p:-20}, {t:'text', i:'ğŸ¾', p:-15}, {t:'text', i:'ğŸ’µ', p:-20}, {t:'text', i:'ğŸ', p:-15}, {t:'text', i:'ğŸ’°', p:-30}]
    };

    function refreshSlogans() { slogans = [...slogansBase].sort(() => Math.random() - 0.5); }
    function getSlogan() { return slogans.length ? slogans.pop() : slogansBase[Math.floor(Math.random()*slogansBase.length)]; }

    const handleMove = (x) => { if (!gameActive) return; playerX = Math.max(0, Math.min(x - 40, window.innerWidth - 80)); player.style.left = playerX + 'px'; };
    gameContainer.addEventListener('mousemove', (e) => handleMove(e.clientX));
    gameContainer.addEventListener('touchmove', (e) => {
        if (gameActive) {
            handleMove(e.touches[0].clientX);
            if (e.cancelable) e.preventDefault();
        }
    }, { passive: false });

    document.getElementById('start-btn').onclick = () => { startScreen.classList.add('hidden'); gameActive = true; startIntervals(); };
    
    document.getElementById('submit-btn').onclick = async () => {
        const name = nicknameInput.value.trim();
        if (!name) { submitError.innerText = "è«‹è¼¸å…¥æ‚¨çš„è‹±é›„æš±ç¨±"; return; }
        const btn = document.getElementById('submit-btn');
        if (scriptURL.includes("æ‚¨çš„ç¶²é æ‡‰ç”¨ç¨‹å¼URL") || scriptURL === "") { submitError.innerText = "å°šæœªåœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®šè©¦ç®—è¡¨ç¶²å€"; return; }
        btn.disabled = true; btn.innerText = "é€£ç·šæª¢æŸ¥ä¸­...";
        submitError.innerText = "";
        try {
            const checkRes = await fetch(`${scriptURL}?score=0&t=${Date.now()}`);
            const checkData = await checkRes.json();
            const listToCheck = checkData.allNames || (checkData.topList ? checkData.topList.map(e => e.name) : []);
            const isDuplicate = listToCheck.some(existingName => existingName.toString().trim().toLowerCase() === name.toLowerCase());
            if (isDuplicate) {
                submitError.innerHTML = "æ­¤æš±ç¨±ã€Œ" + name + "ã€å·²è¢«ä½¿ç”¨ï¼Œ<br>è«‹æ›ä¸€å€‹ç¨±å‘¼å†è©¦è©¦å”·ï¼";
                btn.disabled = false; btn.innerText = "ç¢ºèªä¸¦ä¸Šå‚³åˆ†æ•¸";
                return;
            }
            btn.innerText = "è³‡æ–™ä¸Šå‚³ä¸­...";
            await fetch(scriptURL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "application/x-www-form-urlencoded" }, body: `name=${encodeURIComponent(name)}&score=${score}` });
            setTimeout(async () => {
                const finalRes = await fetch(`${scriptURL}?score=${score}&t=${Date.now()}`);
                const data = await finalRes.json();
                document.getElementById('upload-form').classList.add('hidden');
                document.getElementById('rank-display').classList.remove('hidden');
                document.getElementById('user-rank').innerText = data.userRank;
                if (score >= 250) { rankPrizeMsg.classList.remove('hidden'); }
                prizeMessage.classList.add('hidden');
                finalRestartBtn.innerText = "ç¹¼çºŒæŒ‘æˆ°ä½³ç¸¾";
                finalRestartBtn.classList.remove('bg-gray-800');
                finalRestartBtn.classList.add('bg-blue-600');
                const list = document.getElementById('leaderboard-list');
                let displayRank = 1;
                list.innerHTML = data.topList.map((e, idx) => {
                    if (idx > 0 && e.score < data.topList[idx-1].score) displayRank = idx + 1;
                    return `
                        <div class="flex justify-between items-center py-2.5 border-b border-blue-50 ${e.isUser ? 'bg-yellow-100 text-blue-800 font-black italic rounded px-2' : 'text-gray-600 px-2'}">
                            <span class="flex gap-2 items-center"><span class="w-6 text-gray-400 font-bold text-xs">${displayRank}.</span><span class="font-bold">${e.name}</span></span>
                            <span class="font-black text-blue-600">${e.score}åˆ†</span>
                        </div>
                    `;
                }).join('');
                const userRow = list.querySelector('.bg-yellow-100');
                if (userRow) { setTimeout(() => { userRow.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 500); }
            }, 1000);
        } catch (e) {
            submitError.innerText = "é€£ç·šå¤±æ•—ï¼Œè«‹é‡è©¦";
            btn.disabled = false; btn.innerText = "é‡æ–°é€å‡º";
        }
    };

    function startIntervals() {
        timerInt = setInterval(() => {
            if(!gameActive) return;
            timeLeft--; timerElement.innerText = timeLeft;
            if(timeLeft <= 20) timerBox.classList.add('timer-warning');
            if(timeLeft <= 0) endGame();
        }, 1000);
        gameInt = setInterval(() => { if(gameActive) { spawnItem(); updateItems(); } }, 30);
    }

    function spawnItem() {
        let rate = timeLeft <= 20 ? 0.11 : 0.07;
        if(Math.random() < rate) { 
            const isG = Math.random() > 0.45, c = isG ? config.good[Math.floor(Math.random()*5)] : config.bad[Math.floor(Math.random()*5)];
            const el = document.createElement('div'); el.className = 'falling-item';
            el.innerHTML = c.t === 'svg' ? c.i : `<span class="text-4xl">${c.i}</span>`;
            el.style.left = Math.random() * (window.innerWidth - 45) + 'px';
            el.style.top = '-50px';
            let baseS = timeLeft <= 20 ? 3.2 : 2.4; 
            let accel = (60-timeLeft)*0.06;
            items.push({el, p:c.p, y:-50, s: baseS + Math.random()*2 + accel });
            gameContainer.appendChild(el);
        }
    }

    function updateItems() {
        const pr = player.getBoundingClientRect();
        const hBuffer = 28, vBuffer = 25; 
        for(let i = items.length - 1; i >= 0; i--) {
            const it = items[i]; it.y += it.s; it.el.style.top = it.y + 'px';
            const ir = it.el.getBoundingClientRect();
            if(ir.bottom > pr.top + vBuffer && ir.top < pr.bottom - vBuffer && ir.right > pr.left + hBuffer && ir.left < pr.right - hBuffer) {
                const pts = it.p;
                score = Math.max(0, score + pts); scoreElement.innerText = score;
                showFloat(it.el.style.left, pts);
                if(pts < 0) { 
                    flashRed(); 
                    if (!isIOS && navigator.vibrate) navigator.vibrate(200); 
                    if(timeLeft > 20) pauseGame(); 
                }
                it.el.remove(); items.splice(i, 1); continue;
            }
            if(it.y > window.innerHeight) { it.el.remove(); items.splice(i, 1); }
        }
    }

    function showFloat(x, p) {
        const f = document.createElement('div'); f.className = 'floating-text text-xl'; f.innerText = p > 0 ? `+${p}` : p;
        f.style.color = p > 0 ? '#16a34a' : '#dc2626'; f.style.left = x; f.style.top = (player.offsetTop - 20) + 'px';
        gameContainer.appendChild(f); setTimeout(() => f.remove(), 1000);
    }

    function flashRed() { flashOverlay.style.display = 'block'; setTimeout(() => flashOverlay.style.display = 'none', 100); }
    function pauseGame() {
        gameActive = false; clearInterval(timerInt); clearInterval(gameInt);
        alertMessage.innerHTML = getSlogan(); alertScreen.classList.remove('hidden');
        setTimeout(() => { if(timeLeft > 0) { alertScreen.classList.add('hidden'); gameActive = true; startIntervals(); } }, 1500);
    }

    function endGame() {
        gameActive = false; clearInterval(timerInt); clearInterval(gameInt);
        items.forEach(it => it.el.remove()); items = [];
        finalScoreDisplay.innerText = score;
        if(score >= 250) { 
            resultStatus.innerText = "æŒ‘æˆ°æˆåŠŸ"; 
            resultStatus.className = "text-3xl font-black text-green-600 tracking-tighter"; 
            resultComment.innerText = "ã€Œæ¸…å»‰å¤§å¸«ï¼æ‚¨æ˜¯ç¤¾æœƒèª ä¿¡çš„å…¸ç¯„ï¼ã€"; 
            prizeMessage.innerText = "ğŸ‰ æ­å–œéé—œï¼è«‹å‘å·¥ä½œäººå“¡å‡ºç¤ºæ­¤ç•«é¢é ˜å–å®£å°å“ä¸€ä»½";
        } else if(score >= 180) { 
            resultStatus.innerText = "æŒ‘æˆ°æˆåŠŸ"; 
            resultStatus.className = "text-3xl font-black text-blue-600 tracking-tighter"; 
            resultComment.innerText = "ã€Œå»‰æ½”è¡›å£«ï¼è¡¨ç¾ä¸éŒ¯ï¼Œå†æ¥å†å²ï¼ã€"; 
            prizeMessage.innerText = "è«‹å‹™å¿…å†è©¦ä¸€æ¬¡ï¼Œå»‰èƒ½æ”¿åºœä»°è³´æ‚¨çš„å”åŠ©";
        } else { 
            resultStatus.innerText = "æŒ‘æˆ°å¤±æ•—"; 
            resultStatus.className = "text-3xl font-black text-red-600 tracking-tighter"; 
            resultComment.innerText = "ã€Œèª ä¿¡è­¦å ±ï¼åˆ¥è¢«ç´…åŒ…çµ†å€’å›‰ã€‚ã€"; 
            prizeMessage.innerText = "è«‹å‹™å¿…å†è©¦ä¸€æ¬¡ï¼Œå»‰èƒ½æ”¿åºœä»°è³´æ‚¨çš„å”åŠ©";
        }
        endScreen.classList.remove('hidden'); endScreen.classList.add('flex');
    }
    refreshSlogans();
</script>
</body>
</html>